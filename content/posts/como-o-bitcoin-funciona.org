#+TITLE: Como o Bitcoin funciona?
#+DATE: <2025-05-17>
#+COVER: /blog/como-o-bitcoin-funciona/cover.png

O Bitcoin √© o protocolo de um sistema distribu√≠do P2P (/peer-to-peer/) constru√≠do com base em d√©cadas de pesquisa anteriores em criptografia e sistemas distr√≠buidos. Este protocolo veio ao mundo em 2008 por meio da publica√ß√£o de um artigo intitulado [[https://bitcoin.org/bitcoin.pdf]["Bitcoin: A Peer-to-Peer Electronic Cash System"]] assinado pelo pseud√¥nimo Satoshi Nakomoto. Nakamoto tamb√©m publicou em um f√≥rum online a primeira vers√£o do software com a implementa√ß√£o do protocolo descrito no artigo.

√â por meio da rede P2P que √© poss√≠vel transacionar bitcoins. Ao contr√°rio das moedas tradicionais, o bitcoin √© puramente digital. As moedas est√£o presentes apenas nas transa√ß√µes da rede. Toda transa√ß√£o tem uma quantidade de bitcoins associada e √© protegida por uma chave, somente quem provar ser o seu detentor √© que poder√° criar uma transa√ß√£o v√°lida na rede para gastar aqueles bitcoins. Isso √© poss√≠vel por meio de assinatura digital, cada chave possui duas partes relacionadas, uma p√∫blica (PK, /Public Key/) e outra privada (SK, /Secret Key/). Toda transa√ß√£o inclui a chave p√∫blica de quem est√° recebendo os bitcoins sendo transacionados, a √∫nica maneira de gastar os bitcoins contidos nesta transa√ß√£o √© assinando-a digitalmente, algo que s√≥ pode ser feito tendo em posse a chave privada associada √† chave p√∫blica presente na transa√ß√£o. A assinatura √© realizada a partir do conte√∫do da mensagem e da chave privada, isso significa que n√£o √© poss√≠vel copiar assinaturas para reutilizar em outras transa√ß√µes, j√° que qualquer mudan√ßa na transa√ß√£o ir√° gerar uma assinatura completamente diferente, mesmo utilizando a mesma chave privada, como pode ser visualizado na imagem a seguir:

#+CAPTION: Assinatura digital
#+ATTR_HTML: :alt Assinatura digital
[[file:pk-sk-btc.png]]

Este processo remove a necessidade de bancos como entidades de cust√≥dia no Bitcoin, todos os bitcoins s√£o protegidos pela rede. Logo, por meio da auto-cust√≥dia de suas chaves voc√™ se transforma no seu pr√≥prio banco. Mas como nos ensinou Tio Ben - Com grandes poderes v√™m grandes responsabilidades. As chaves podem ser armazenadas de in√∫meras maneiras: na sua cabe√ßa via memoriza√ß√£o, em um peda√ßo de papel ou em uma placa met√°lica, ou em dispositivos projetados para esse fim conhecidos como /Hard-Wallets/. Dependendo do capital que planeja proteger, uma √∫nica chave pode ser arriscado, caso seja roubada, adeus para seus fundos. Para resolver este problema existe a possibilidade de criar suas transa√ß√µes com endere√ßos multisig que requerem assinaturas de m√∫ltiplas chaves para destravar os bitcoins contidos nas transa√ß√µes.

* Seguran√ßa da Rede

Mas voc√™ pode estar se perguntando, como √© que a rede garante a seguran√ßa de todas as transa√ß√µes. Isso √© trabalho de todos os nodos da rede. Cada nodo recebe todas as transa√ß√µes enviadas atrav√©s da rede e verifica uma por uma. Esta verifica√ß√£o deve garantir que a assinatura realizada por quem transmitiu a transa√ß√£o para a rede √© v√°lida, ou seja, quem assinou a transa√ß√£o √© o dono da chave privada relacionada com a chave p√∫blica presente na transa√ß√£o. Uma transa√ß√£o t√™m v√°rios campos, mas para o entendimento do processo de verifica√ß√£o, basta considerarmos o seguinte:

- =data=: Representa todos os dados presentes na transa√ß√£o;
- =PK=: Representa a chave p√∫blica da transa√ß√£o;
- =Signature=: Representa a assinatura da transa√ß√£o.

O processo de verifica√ß√£o √© de fato muito simples, basta executar determinada fun√ß√£o que verifica se a assinatura √© v√°lida para os dados da transa√ß√£o e para a chave p√∫blica, algo como =Verify(data, Signature, PK)=. Caso a fun√ß√£o retorne =true= (verdadeiro), a transa√ß√£o √© validada e retransmitida para os outros nodos da rede, caso contr√°rio √° rejeitada.

Agora espero que tenho ficado claro o motivo pelo qual se diz que a natureza descentralizada do Bitcoin por meio da sua rede P2P resolve o problema do gasto duplo, removendo a necessidade de uma entidade centralizadora que seria suscet√≠vel a ataques, por exemplo, por parte dos governos. Toda nova transa√ß√£o √© retransmitida e validada por todos os nodos da rede pelo processo acima detalhado, tornando imposs√≠vel um ataque na pr√°tica, dada a quantidade de nodos rodando Bitcoin atualmente.

* Consenso da Rede

Com transa√ß√µes sendo transmitidas de nodo para nodo sem qualquer ordem, como √© que a rede chega a um consenso para que todos os nodos concordem com as mesmas transa√ß√µes v√°lidas na mesma ordem? Este foi o maior problema que Satoshi Nakamoto resolveu, e o fez por meio do algoritmo de /proof-of-work/ (prova de trabalho). Quando uma transa√ß√£o √© transmitida para a rede, ela √© validada, mas ainda n√£o faz parte do livro-raz√£o do Bitcoin, mais conhecido como /blockchain/ - este nome se d√° pois a estrutura de dados utilizada para armazenar as transa√ß√µes √© uma lista encadeada de blocos. Para a inclus√£o de um novo bloco na /blockchain/ √© necess√°rio uma prova de trabalho que confirme que recursos computacionais foram investidos para a valida√ß√£o de todas as transa√ß√µes presentes naquele bloco. O algoritmo /proof-of-work/ consiste na descoberta de um n√∫mero que aplicado √† uma fun√ß√£o de hash juntamente com os dados de todas as transa√ß√µes selecionadas para fazerem parte do bloco, gere como resultado uma sa√≠da que satisfa√ßa a dificuldade da rede. Ao conseguir este n√∫mero o bloco pode ser retransmitido para a rede, todos os nodos ir√£o validar a prova de trabalho, e uma vez confirmada, ir√£o incluir aquele bloco em suas /blockchains/, tornando assim poss√≠vel o consenso entre todos os nodos da rede. A fun√ß√£o hash aplicada n√£o √© qualquer fun√ß√£o, √© uma fun√ß√£o de hash criptogr√°fica, o =SHA256=, isso significa que n√£o existe maneira de acelerar o processo de descoberta do valor sendo buscado, a √∫nica maneira √© aplicar a fun√ß√£o a todos os valores poss√≠veis. A seguir est√° ilustrado um exemplo da descoberta do n√∫mero para a valida√ß√£o de um bloco:

#+CAPTION: Proof-of-work
#+ATTR_HTML: :alt Proof-of-work
[[file:proof-of-work.png]]

Satisfazer a dificuldade da rede significa que o retorno da fun√ß√£o =SHA256= deve iniciar com um determinado n√∫mero de zeros, quanto maior a dificuldade da rede, maior o n√∫mero de zeros, e menor a probabilidade de encontrar tal resultado.

Assim como transa√ß√µes s√£o v√°lidas apenas se contiverem assinaturas v√°lidas, blocos s√£o v√°lidos apenas se contiverem provas de trabalho v√°lidas. A /blockchain/ √© estruturada de tal forma que qualquer tentativa de corrup√ß√£o dos seus dados invalida toda a cadeia, dessa maneira qualquer tentativa de fraude √© logo identificada e rejeitada pela rede:

#+CAPTION: Blockchain
#+ATTR_HTML: :alt Blockchain
[[file:blockchain.png]]

Qualquer altera√ß√£o em uma √∫nica transa√ß√£o, por menor que seja, ir√° alterar o hash gerado para verifica√ß√£o da prova de trabalho, invalidando o bloco, assim como todos os blocos posteriores, uma vez que os blocos s√£o conectados pelo hash da prova de trabalho. Ou seja, para fraudar uma transa√ß√£o inclu√≠da no √∫ltimo bloco da rede √© necess√°rio refazer todo o trabalho e transmitir o bloco para a rede, antes que um novo bloco seja minerado. Quanto mais blocos forem adicionados ap√≥s o bloco contendo a transa√ß√£o que se deseja fraudar, s√£o mais blocos para refazer a prova de trabalho. Na pr√°tica, para adulterar a /blockchain/ √© preciso controlar no m√≠nimo 51% do poder computacional da rede.

Para recompensar o criador do bloco por todo o trabalho realizado, o protocolo permite a adi√ß√£o de uma transa√ß√£o enviando como pagamento para si pr√≥prio alguns bitcoins. √â assim que novas unidades de bitcoin s√£o criadas, e √© por isso que esse processo √© conhecido como minera√ß√£o e os criadores de bloco como mineradores:

#+CAPTION: Minera√ß√£o
#+ATTR_HTML: :alt Minera√ß√£o
[[file:mining.png]]

A recompensa do minerador por cada bloco minerado √© uma quantidade de bitcoins (que diminui pela metade periodicamente no evento conhecido como /Halving/), mais a soma de todas as taxas pagas pelos usu√°rios que criaram as transa√ß√µes inclu√≠das pelo minerador no bloco - por isso que taxas mais altas t√™m prefer√™ncia na rede. A dificuldade √© ajustada periodicamente pelo protocolo da rede, de forma a garantir que um novo bloco seja gerado a cada 10 minutos. Ou seja, quanto mais mineradores, maior ser√° a dificuldade de minera√ß√£o para garantir a pol√≠tica de gera√ß√£o de novos blocos a cada 10 minutos. Para garantir que apenas transa√ß√µes v√°lidas sejam adicionadas nos blocos pelos mineradores, a recompensa s√≥ pode ser resgatada se todas as transa√ß√µes inclu√≠das no bloco forem v√°lidas.

Quando algum minerador resolve a prova de trabalho, ele retransmite o bloco para os demais nodos da rede. Conforme os demais mineradores recebem o novo bloco, eles param o processo de minera√ß√£o do bloco atual, e recome√ßam, gerando novos blocos candidatos com novas transa√ß√µes.

* Participando da rede

O ponto mais importante √© definir quem voc√™ quer ser na rede, algu√©m que delega a responsabilidade da cust√≥dia das suas chaves para outras entidades, algu√©m que delega a responsabilidade da valida√ß√£o das transa√ß√µes para outros nodos, ou um verdadeiro soberano dos seus bitcoins. Estas tr√™s op√ß√µes podem ser acessadas das seguintes maneiras:

- Via corretoras: neste cen√°rio voc√™ n√£o det√©m a posse das chaves, voc√™ cria uma conta na corretora, envia dinheiro fiat em troca da promessa da corretora por bitcoins. Como Andreas Antonopulous disse - /Your keys, your coins. Not your keys, not your coins/;
- Sendo cliente da rede: neste cen√°rio, voc√™ det√©m a posse das chaves, mas delega a resposabildade da valida√ß√£o das transa√ß√µes para outros nodos da rede;
- Sendo um /full node/: neste cen√°rio voc√™ torna-se verdadeiramente soberando em rela√ß√£o aos seus bitcoins, voc√™ det√™m a posse das suas chaves e voc√™ valida todas as transa√ß√µes. Al√©m de ser soberano, voc√™ aumenta a seguran√ßa da rede, sendo um nodo a mais que ir√° validar todas as transa√ß√µes transmitidas para a rede.

A maneira mais comum de se comunicar com a rede Bitcoin √© por meio de wallets que implementam o protocolo, permitindo a cria√ß√£o de transa√ß√µes, bem como a gera√ß√£o de endere√ßos para o recebimento de pagamentos. Existem variados tipos de wallets: desktop, mobile e web. Sendo um cliente, a sua wallet ir√° se comunicar com outros nodos da rede. No entando, se voc√™ roda o seu pr√≥prio nodo, voc√™ pode configurar a sua wallet para comunicar-se exclusivamente com o seu nodo.

Era isso para o primeiro artigo sobre Bitcoin, nos pr√≥ximos irei aprofundar na parte t√©cnica de t√≥picos como chaves, endere√ßos e transa√ß√µes.

*Don't trust, verify. üïµüèª‚Äç‚ôÇÔ∏è*

*Refer√™ncias*

Antonopoulos, A., & Harding, D. (2023). Mastering Bitcoin: Programming the Open Blockchain.
